<!doctype html>
<html lang="en">
<head>
  <!-- Basic Meta Tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- SEO Meta Tags -->
  <title>bibleRPG - Biblical Adventure Role Playing Game</title>
  <meta name="description" content="Experience biblical adventures in this immersive RPG. Grow in faith, wisdom, and service as you journey through biblical locations and complete scripture-based quests." />
  <meta name="keywords" content="bible, rpg, christian game, biblical adventure, scripture, faith, wisdom, service" />
  <meta name="author" content="bibleRPG Team" />
  <meta name="robots" content="index, follow" />
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="bibleRPG - Biblical Adventure Role Playing Game" />
  <meta property="og:description" content="Experience biblical adventures in this immersive RPG. Grow in faith, wisdom, and service as you journey through biblical locations." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://biblerpg.com/test.html" />
  <meta property="og:image" content="https://biblerpg.com/screenshot.png" />
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="bibleRPG - Biblical Adventure Role Playing Game" />
  <meta name="twitter:description" content="Experience biblical adventures in this immersive RPG." />
  <meta name="twitter:image" content="https://biblerpg.com/screenshot.png" />
  <style>
    :root{
      --bg:#0f1222; --panel:#151936; --panel-2:#1c2150; --accent:#7aa2ff; --accent-2:#70f0c4;
      --text:#e9ebff; --muted:#9aa3cf; --good:#70f0c4; --warn:#ffd166; --bad:#ff6b6b;
      --btn:#222a63; --btn-hover:#2a3482; --chip:#232a5a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:24px/1.4 system-ui,'AR CENA',Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text); background:linear-gradient(180deg,#0f1222 0%,#0f1428 70%,#0f1222 100%);
    }
    header{
      padding:16px 20px; border-bottom:1px solid #2b336b; background:rgba(12,14,30,.7); backdrop-filter: blur(6px);
      display:flex; align-items:center; gap:12px; position:sticky; top:0; z-index:2;
    }
    header h1{margin:0; font-size:30px; font-weight:700; letter-spacing:.3px}
    header .subtitle{color:var(--muted); font-size:26px}
    main{
      display:grid; grid-template-columns: 2.2fr 1.2fr; gap:16px; padding:16px; max-width:1200px; margin:0 auto;
    }
    @media (max-width: 920px){ main{grid-template-columns: 1fr} }
    .card{
      background:linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%); border:1px solid #262e66; border-radius:12px; overflow:hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
    }
    .card h2{
      margin:0; padding:12px 14px; font-size:14px; color:var(--muted); letter-spacing:.4px; text-transform:uppercase; border-bottom:1px solid #27306a;
      background:linear-gradient(180deg,#1a1f48 0%,#151936 100%); position:sticky; top:48px; z-index:1;
    }
    .section{padding:14px}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .stack{display:flex; flex-direction:column; gap:10px}
    .muted{color:var(--muted)}
    .pill{
      display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; background:var(--chip); border:1px solid #2a3470; color:var(--text); font-size:13px;
    }
    .bar{
      height:8px; background:#1b1f45; border-radius:999px; overflow:hidden; border:1px solid #2a3270;
    }
    .bar > i{
      display:block; height:100%; background:linear-gradient(90deg,var(--accent) 0%, var(--accent-2) 100%); width:0%;
      transition:width .35s ease;
    }
    .btn{
      appearance:none; border:none; cursor:pointer; border-radius:10px; padding:10px 12px; background:var(--btn); color:var(--text);
      border:1px solid #2a3470; font-weight:600; letter-spacing:.2px; transition: all .15s ease;
    }
    .btn:hover{background:var(--btn-hover); transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn-row{display:flex; gap:10px; flex-wrap:wrap}
    .choice{display:flex; flex-direction:column; gap:6px; min-width:260px}
    .choice small{color:var(--muted)}
    select, .input{
      background:#161b3f; color:var(--text); border:1px solid #2a3470; border-radius:8px; padding:8px 10px; font-weight:600;
    }
    .log{
      height:220px; overflow:auto; background:rgba(9,11,24,.55); border:1px solid #262f68; border-radius:10px; padding:10px;
    }
    .log p{margin:0 0 8px}
    .token{display:inline-block; margin:4px 6px 0 0; padding:6px 8px; border-radius:8px; border:1px solid #27306a; background:#171b3d; font-size:13px}
    .kv{display:grid; grid-template-columns: 120px 1fr; gap:6px 10px; align-items:center}
    .divider{height:1px; background:#27306a; margin:10px 0}
    .footer{padding:10px 16px; color:var(--muted); font-size:12px; text-align:center}
    .title-ribbon{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:8px; border:1px solid #2a3470; background:linear-gradient(180deg,#1c2456,#14193d);
      box-shadow: inset 0 0 12px rgba(112,240,196,.12);
    }
    .good{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .sr{position:absolute; left:-9999px}
    
    /* Screen Reader Only Content */
    .sr-only {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    
    /* Enhanced Button Interactions */
    .btn:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    /* Enhanced Card Hover Effects */
    .card:hover {
      transform: translateY(-2px);
      transition: transform 0.2s ease;
    }
    
    /* Enhanced Mobile Support */
    @media (max-width: 768px) {
      main {
        grid-template-columns: 1fr;
        padding: 12px;
        gap: 12px;
      }
      
      header {
        padding: 12px 16px;
      }
      
      header h1 {
        font-size: 24px;
      }
      
      header .subtitle {
        font-size: 20px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        font-size: 20px;
      }
      
      main {
        padding: 8px;
        gap: 8px;
      }
      
      .choice {
        min-width: 200px;
      }
    }
    
    /* Enhanced Progress Bar Animation */
    .bar > i {
      transition: width 0.5s ease;
    }
    
    /* Loading Animation */
    .loading {
      position: relative;
      overflow: hidden;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% { left: -100%; }
      100% { left: 100%; }
    }
  </style>
</head>
<body>
  <!-- Skip Navigation Link for Accessibility -->
  <a href="#main-content" class="sr-only">Skip to main content</a>
  
  <!-- Header Section -->
  <header role="banner">
    <div style="font-size:18px" aria-hidden="true">‚úùÔ∏è</div>
    <div>
      <h1>bibleRPG</h1>
      <div class="subtitle">Hear What The Spirit Says To The Soul!</div>
    </div>
  </header>

  <!-- Main Game Content -->
  <main id="main-content" role="main">
    <!-- Adventure Section -->
    <section class="card" aria-live="polite" aria-atomic="true" aria-label="Adventure section">
      <h2 id="adventure-heading">Adventure</h2>
      <div class="section stack">
        <!-- Location and Travel Controls -->
        <div class="row" id="locationRow">
          <span class="pill" aria-label="Current location">
            <span aria-hidden="true">üìç</span>
            <strong id="locName" aria-describedby="location-description">Location</strong>
          </span>
          <label class="pill" for="travelSelect">
            <span aria-hidden="true">üß≠</span>
            <strong>Travel</strong>
          </label>
          <select 
            id="travelSelect" 
            aria-label="Choose destination to travel to"
            aria-describedby="travel-help"
          ></select>
          <button class="btn" id="travelBtn" aria-describedby="travel-help">Go</button>
          <button 
            class="btn" 
            id="resetBtn" 
            title="Clear all progress and restart game"
            aria-label="Reset game progress"
          >Reset</button>
        </div>
        <div id="travel-help" class="sr-only">
          Select a destination from the dropdown and click Go to travel there
        </div>

        <!-- Game Scenario and Choices -->
        <div class="stack">
          <div 
            id="scenario" 
            class="section" 
            style="background:#0f132e;border:1px solid #262f68;border-radius:10px"
            role="region"
            aria-label="Current scenario"
            aria-live="polite"
          ></div>
          <div 
            class="btn-row" 
            id="choices"
            role="group"
            aria-label="Available choices"
          ></div>
        </div>

        <!-- Character Stats Display -->
        <div class="stack" role="region" aria-label="Character statistics">
          <div class="kv">
            <div>Faith</div>
            <div class="bar" title="Faith level progress" role="progressbar" aria-label="Faith progress">
              <i id="faithBar" aria-hidden="true"></i>
            </div>
            <div>Wisdom</div>
            <div class="bar" title="Wisdom level progress" role="progressbar" aria-label="Wisdom progress">
              <i id="wisdomBar" aria-hidden="true"></i>
            </div>
            <div>Service</div>
            <div class="bar" title="Service level progress" role="progressbar" aria-label="Service progress">
              <i id="serviceBar" aria-hidden="true"></i>
            </div>
          </div>
          <div class="divider" aria-hidden="true"></div>
          <div class="row">
            <div class="title-ribbon" role="status" aria-label="Current title">
              <span aria-hidden="true">üèÖ</span>
              <span id="titleValue">Service Title</span>
            </div>
          </div>
        </div>

        <!-- Event Log Section -->
        <div role="region" aria-label="Game events">
          <h3 style="margin:8px 0 6px;font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">
            Event log
          </h3>
          <div 
            class="log" 
            id="log" 
            role="log" 
            aria-live="polite"
            aria-label="Recent game events"
            tabindex="0"
          ></div>
        </div>
      </div>
    </section>

    <!-- Profile Sidebar -->
    <aside class="card" role="complementary" aria-label="Player profile">
      <h2 id="profile-heading">Profile</h2>
      <div class="section stack">
        <!-- Character Stats Summary -->
        <div class="stack" role="region" aria-labelledby="stats-heading">
          <div class="row">
            <span class="pill" id="stats-heading">
              <span aria-hidden="true">üìä</span>
              <strong>Stats</strong>
            </span>
          </div>
          <div class="kv" aria-label="Character statistics values">
            <div>Faith:</div>
            <div id="faithVal" aria-label="Faith value">0</div>
            <div>Wisdom:</div>
            <div id="wisdomVal" aria-label="Wisdom value">0</div>
            <div>Service:</div>
            <div id="serviceVal" aria-label="Service value">0</div>
          </div>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <!-- Rewards Section -->
        <div class="stack" role="region" aria-labelledby="rewards-heading">
          <div class="row">
            <span class="pill" id="rewards-heading">
              <span aria-hidden="true">üéÅ</span>
              <strong>Rewards:</strong>
            </span>
          </div>
          <div 
            id="rewards" 
            class="row"
            aria-label="Collected rewards"
            aria-describedby="rewards-description"
          ></div>
          <div id="rewards-description" class="sr-only">
            This section displays rewards you have earned through completing quests and achieving milestones
          </div>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <!-- Quest Information -->
        <div class="stack" role="region" aria-labelledby="quest-heading">
          <div class="row">
            <span class="pill" id="quest-heading">
              <span aria-hidden="true">üó°Ô∏è</span>
              <strong>Quest:</strong>
            </span>
          </div>
          <div 
            id="questBox" 
            class="stack"
            aria-label="Current quest information"
            aria-live="polite"
          ></div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Footer -->
  <footer class="footer" role="contentinfo">
    <span>2025 @ bibleRPG</span>
    <span class="sr-only"> - Biblical Role Playing Game</span>
  </footer>

  <script>
    // ----------------------------
    // Data tables
    // ----------------------------
    const LOCATIONS = ['Galilee','Jerusalem', 'Bethlehem', 'Damascus', 'Wilderness', 'Israel', 'Sea of Galilee', 'Babylon'];

    const locationFlavors = {
      Galilee: [
        'You arrive by the Sea of Galilee as dawn gilds the water.',
        'Fishermen mend their nets; gulls arc over the tide.',
        'A hush falls as the wind softens across the shore.'
      ],
      Jerusalem: [
        'Stone steps climb toward the Temple courts, alive with voices.',
        'Shadows of pillars stretch long across the courtyard.',
        'Whispers of prophecy linger in the narrow streets.'
      ]
    };

    const questPool = {
      Galilee: [
        {
          id:'fishers_of_men',
          description:'Share the Good News with the villagers by the shore.',
          requirements:{faith:2},
          reward:{type:'title', value:'Fisher of Men'},
          scripture:'Matthew 4:19'
        },
        {
          id:'calm_the_storm',
          description:'Pray for calm as the winds rise over the sea.',
          requirements:{faith:4, wisdom:2},
          reward:{type:'miracle', value:'Calmed Storm'},
          scripture:'Mark 4:39'
        }
      ],
      Jerusalem: [
        {
          id:'teach_in_temple',
          description:'Engage in debate with the teachers in the temple courts.',
          requirements:{wisdom:3},
          reward:{type:'item', value:'Scroll of Insight'},
          scripture:'Luke 2:46-47'
        }
      ]
    };

    const milestones = {
      faith: { 5: { type:'miracle', value:'Parted Waters' } },
      wisdom:{ 5: { type:'miracle', value:'Prophetic Vision' } },
      service:{ 5: { type:'miracle', value:'Feeding the Multitude' } }
    };

    const locationBlessings = {
      Galilee: [
        {
          requirements:{faith:3},
          blessing:{type:'vision', value:'A net overflowing with fish ‚Äî a promise of abundance.'},
          scripture:'Luke 5:6'
        }
      ],
      Jerusalem: [
        {
          requirements:{wisdom:4, service:2},
          blessing:{type:'favor', value:'The elders grant you access to the inner courts.'},
          scripture:'Acts 6:10'
        }
      ]
    };

    const choicesData = [
      { id:'faith_choice', label:'üôè Wait upon the Lord‚Äôs guidance', stat:'faith', scripture:'Isaiah 40:31' },
      { id:'wisdom_choice', label:'üìñ Seek counsel from the elders', stat:'wisdom', scripture:'Proverbs 11:14' },
      { id:'service_choice', label:'ü§ù Help the wounded traveler', stat:'service', scripture:'Luke 10:33‚Äì34' }
    ];

    // ----------------------------
    // State & persistence
    // ----------------------------
    const STORAGE_KEY = 'gospel_rpg_state_v1';

    const defaultState = () => ({
      stats:{ faith:0, wisdom:0, service:0 },
      location:[],
      rewards:[],   // array of {type,value}
      items:[],     // derived from rewards
      title:[],
      achievedMilestones:{}, // e.g., "faith:5":true
      currentQuest:[],
      log:[]
    });

    let state = load();

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)) }
    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : defaultState();
      }catch{ return defaultState() }
    }
    function reset(){
      state = defaultState();
      addLog('üîÑ Progress reset.');
      enterLocation(state.location, {announce:false});
      render();
      save();
    }

    // ----------------------------
    // Helpers
    // ----------------------------
    const $ = sel => document.querySelector(sel);
    function el(tag, props={}, children=[]){
      const e = document.createElement(tag);
      Object.entries(props).forEach(([k,v])=>{
        if(k==='class') e.className = v;
        else if(k==='html') e.innerHTML = v;
        else e.setAttribute(k, v);
      });
      [].concat(children).forEach(c => {
        if(typeof c === 'string') e.appendChild(document.createTextNode(c));
        else if(c) e.appendChild(c);
      });
      return e;
    }
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];
    const meets = (stats, reqs) => Object.entries(reqs).every(([s,val]) => (stats[s]||0) >= val);
    const rewardKey = r => `${r.type}:${r.value}`;
    const hasReward = r => state.rewards.some(x => rewardKey(x)===rewardKey(r));

    function addLog(line){
      state.log.unshift(line);
      state.log = state.log.slice(0, 80);
    }

    // ----------------------------
    // Core systems
    // ----------------------------
    function scenarioFor(location){
      return pick(locationFlavors[location] || ['You continue on your way.']);
    }

    function assignQuest(location){
      const pool = questPool[location] || [];
      const candidates = pool.filter(q => meets(state.stats, q.requirements));
      if(!candidates.length) return null;
      return pick(candidates);
    }

    function applyReward(reward){
      if(!hasReward(reward)) state.rewards.push(reward);

      switch(reward.type){
        case 'miracle':
          addLog(`üåü Miracle! ${reward.value}`);
          return `üåü Miracle! ${reward.value}`;
        case 'title':
          state.title = reward.value;
          addLog(`üèÖ You are now known as ‚Äú${reward.value}‚Äù.`);
          return `üèÖ You are now known as ‚Äú${reward.value}‚Äù.`;
        case 'item':
          if(!state.items.includes(reward.value)) state.items.push(reward.value);
          addLog(`üì¶ You obtained: ${reward.value}`);
          return `üì¶ You obtained: ${reward.value}`;
        case 'vision':
          addLog(`üëÅÔ∏è Vision: ${reward.value}`);
          return `üëÅÔ∏è Vision: ${reward.value}`;
        case 'favor':
          addLog(`üí† Favor: ${reward.value}`);
          return `üí† Favor: ${reward.value}`;
        default:
          return '';
      }
    }

    function checkMilestones(){
      const notes = [];
      for(const stat of Object.keys(milestones)){
        const cur = state.stats[stat] || 0;
        const table = milestones[stat] || {};
        if(table[cur]){
          const key = `${stat}:${cur}`;
          if(!state.achievedMilestones[key]){
            state.achievedMilestones[key] = true;
            notes.push(applyReward(table[cur]));
          }
        }
      }
      return notes;
    }

    function checkLocationBlessings(location){
      const list = locationBlessings[location] || [];
      const notes = [];
      list.forEach(b => {
        if(meets(state.stats, b.requirements)){
          notes.push(`${applyReward(b.blessing)} (${b.scripture})`);
        }
      });
      return notes;
    }

    function enterLocation(location, {announce=true}={}){
      state.location = location;
      const lines = [];

      if(announce){
        lines.push(`üß≠ You arrive in ${location}.`);
      }
      lines.push(scenarioFor(location));

      const blessings = checkLocationBlessings(location);
      if(blessings.length) lines.push(...blessings);

      // Assign a quest if eligible (immediate completion demo)
      const q = assignQuest(location);
      state.currentQuest = q;
      if(q){
        lines.push(`üó°Ô∏è Quest: ${q.description} (${q.scripture})`);
        // In this single-file demo we auto-complete for momentum
        const rewardMsg = applyReward(q.reward);
        lines.push(`‚úÖ Quest Completed: ${q.description}`);
        if(rewardMsg) lines.push(rewardMsg);
      }else{
        lines.push('üó°Ô∏è No quests available yet. Grow in your stats to unlock more.');
      }

      addLog(lines.join(' '));
      $('#scenario').innerHTML = lines.map(l => `<p>${l}</p>`).join('');
      save();
    }

    function handleChoice(choiceId){
      const choice = choicesData.find(c => c.id===choiceId);
      if(!choice) return;

      const stat = choice.stat;
      state.stats[stat] = (state.stats[stat]||0) + 1;

      const choiceLine = `‚ú® You chose: ${choice.label} (${choice.scripture})`;
      addLog(choiceLine);

      const milestoneNotes = checkMilestones();
      const nextIndex = (LOCATIONS.indexOf(state.location)+1) % LOCATIONS.length;
      const nextLoc = LOCATIONS[nextIndex];

      const lines = [choiceLine];
      if(milestoneNotes.length) lines.push(...milestoneNotes);

      $('#scenario').innerHTML = lines.map(l => `<p>${l}</p>`).join('');

      // Travel after a short beat to simulate turn flow
      setTimeout(()=>{
        enterLocation(nextLoc);
        render();
      }, 400);

      render();
      save();
    }

    // ----------------------------
    // UI wiring
    // ----------------------------
    function render(){
      // Location
      $('#locName').textContent = state.location;
      // Stats values
      $('#faithVal').textContent = state.stats.faith;
      $('#wisdomVal').textContent = state.stats.wisdom;
      $('#serviceVal').textContent = state.stats.service;
      // Bars (cap at 10 for display)
      const cap = v => Math.max(0, Math.min(10, v));
      $('#faithBar').style.width = (cap(state.stats.faith)*10)+'%';
      $('#wisdomBar').style.width = (cap(state.stats.wisdom)*10)+'%';
      $('#serviceBar').style.width = (cap(state.stats.service)*10)+'%';

      // Title
      $('#titleValue').textContent = state.title || 'No title yet';

      // Rewards
      const rewardsBox = $('#rewards');
      rewardsBox.innerHTML = '';
      if(!state.rewards.length){
        rewardsBox.appendChild(el('div',{class:'muted'},['No rewards yet']));
      }else{
        state.rewards.forEach(r=>{
          rewardsBox.appendChild(el('span',{class:'token'},[`${iconFor(r.type)} ${r.value}`]));
        });
      }

      // Quest box
      const qb = $('#questBox');
      qb.innerHTML = '';
      if(state.currentQuest){
        qb.appendChild(el('div',{class:'stack'},[
          el('div',{class:'row'},[el('span',{class:'pill'},[`üìú `, el('strong',{},['Description'])]), el('span',{},[state.currentQuest.description])]),
          el('div',{class:'row'},[el('span',{class:'pill'},[`üìñ `, el('strong',{},['Scripture'])]), el('span',{},[state.currentQuest.scripture])]),
          el('div',{class:'row'},[el('span',{class:'pill'},[`üéØ `, el('strong',{},['Requirements'])]),
            el('span',{},[reqText(state.currentQuest.requirements)])]),
          el('div',{class:'row'},[el('span',{class:'pill'},[`üéÅ `, el('strong',{},['Reward'])]),
            el('span',{},[`${state.currentQuest.reward.type}: ${state.currentQuest.reward.value}`])])
        ]));
      }else{
        qb.appendChild(el('div',{class:'muted'},['No active quest.']));
      }

      // Choices
      const choices = $('#choices');
      choices.innerHTML = '';
      choicesData.forEach(c=>{
        const btn = el('button',{class:'btn', id:c.id},[c.label]);
        const sub = el('small',{},[c.scripture]);
        const wrap = el('div',{class:'choice'},[btn, sub]);
        btn.addEventListener('click', ()=>handleChoice(c.id));
        choices.appendChild(wrap);
      });

      // Log
      const log = $('#log');
      log.innerHTML = state.log.map(line=>`<p>${line}</p>`).join('');
    }

    function iconFor(type){
      switch(type){
        case 'miracle': return 'üåü';
        case 'title': return 'üèÖ';
        case 'item': return 'üì¶';
        case 'vision': return 'üëÅÔ∏è';
        case 'favor': return 'üí†';
        default: return 'üéÅ';
      }
    }
    function reqText(reqs){
      const parts = [];
      if('faith' in reqs) parts.push(`Faith ${reqs.faith}+`);
      if('wisdom' in reqs) parts.push(`Wisdom ${reqs.wisdom}+`);
      if('service' in reqs) parts.push(`Service ${reqs.service}+`);
      return parts.join(', ') || 'None';
    }

    function initUI(){
      // Travel control
      const sel = $('#travelSelect');
      sel.innerHTML = '';
      LOCATIONS.forEach(loc=>{
        const o = el('option',{value:loc},[loc]);
        sel.appendChild(o);
      });
      sel.value = state.location;
      $('#travelBtn').addEventListener('click', ()=>{
        const dest = sel.value;
        if(dest && dest !== state.location){
          enterLocation(dest);
          render();
          save();
        }
      });
      // Reset
      $('#resetBtn').addEventListener('click', reset);
    }

    // ----------------------------
    // Boot
    // ----------------------------
    window.addEventListener('DOMContentLoaded', ()=>{
      initUI();
      // First-time arrival narrative
      if(state.log.length===0){
        enterLocation(state.location, {announce:true});
      }else{
        // Ensure scenario shows something on reload
        $('#scenario').innerHTML = state.log.slice(0,3).reverse().map(l=>`<p>${l}</p>`).join('');
      }
      render();
      save();
    });
  </script>
</body>
</html>
